{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Class Groups</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container py-5">
  <h3 class="mb-4">Manage Class Groups</h3>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}

  <!-- Add Class Group Form -->
  <form method="post" class="row g-3 mb-5">
    {% csrf_token %}
    <div class="col-md-4">
      <label class="form-label">Class Name</label>
      <input type="text" name="name" class="form-control" required>
    </div>
    <div class="col-md-4">
      <label class="form-label">School</label>
      <select name="school" class="form-control" required>
        {% for school in schools %}
          <option value="{{ school.id }}">{{ school.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4 mt-4">
      <button type="submit" class="btn btn-success w-100">Add Class Group</button>
    </div>
  </form>

  <!-- Class Groups Table -->
  <table class="table table-bordered">
    <thead class="table-light">
      <tr>
        <th>Class Name</th>
        <th>School</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for group in classgroups %}
        <tr>
          <td>{{ group.name }}</td>
          <td>{{ group.school.name }}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary edit-btn"
                    data-bs-toggle="modal"
                    data-bs-target="#editModal"
                    data-id="{{ group.id }}"
                    data-name="{{ group.name }}"
                    data-school="{{ group.school.id }}">
              Edit
            </button>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" id="editForm">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title">Edit Class Group</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="classgroup_id" id="editId">

          <div class="mb-3">
            <label class="form-label">Class Name</label>
            <input type="text" class="form-control" name="name" id="editName" required>
          </div>

          <div class="mb-3">
            <label class="form-label">School</label>
            <select name="school" class="form-control" id="editSchool">
              {% for school in schools %}
                <option value="{{ school.id }}">{{ school.name }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Save Changes</button>
          <a href="#" id="deleteBtn" class="btn btn-danger"
             onclick="return confirm('Are you sure you want to delete this class group?')">Delete</a>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Bootstrap + Modal JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const modal = document.getElementById("editModal");
  const form = document.getElementById("editForm");
  const deleteBtn = document.getElementById("deleteBtn");

  modal.addEventListener("show.bs.modal", event => {
    const button = event.relatedTarget;
    const id = button.getAttribute("data-id");
    const name = button.getAttribute("data-name");
    const schoolId = button.getAttribute("data-school");

    document.getElementById("editId").value = id;
    document.getElementById("editName").value = name;
    document.getElementById("editSchool").value = schoolId;

    form.action = `/superadmin/classgroups/edit/${id}/`;
    deleteBtn.href = `/superadmin/classgroups/delete/${id}/`;
  });
</script>
</body>
</html>
